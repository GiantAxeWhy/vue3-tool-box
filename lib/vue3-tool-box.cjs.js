"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("vue"),O={name:"VertifySlide",props:{onDraw:t=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["verfity-slide","fail-slide"],setup(t,l){const n=s.reactive({sliderLeft:0,isLoading:!1,textTip:"",sliderClass:"sliderContainer",vertifyWrapClass:"vertifyWrap",blockRef:null,trailRef:[],isMouseDownRef:!1,imgRef:null,refreshIcon:"http://cdn.dooring.cn/dr/icon12.png"}),i=42,d=9,u=i+d*2+3,g=Math.PI,c=320,p=160;let M=s.ref(null);const v=s.ref(0),R=s.ref(0),C=s.ref(0),D=s.ref(0),S=(e,o,a,r)=>{console.log("ctx",e),e.beginPath(),e.moveTo(o,a),e.arc(o+i/2,a-d+2,d,.72*g,2.26*g),e.lineTo(o+i,a),e.arc(o+i+d-2,a+i/2,d,1.21*g,2.78*g),e.lineTo(o+i,a+i),e.lineTo(o,a+i),e.arc(o+d-2,a+i/2,d+.4,2.76*g,1.24*g,!0),e.lineTo(o,a),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over",r==="fill"?e.fill():e.clip()};function k(e,o){return Math.round(Math.random()*(o-e)+e)}function I(e,o){return e+o}function T(e){return e*e}const V=()=>{const e=N(()=>{L(e)});n.imgRef=e},N=e=>{const o=new Image;return o.onload=e,o.crossOrigin="Anonymous",console.log("img",o),o.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",o},X=()=>{y()},w=()=>{console.log(222),y(),l.emit("verfity-slide")},E=()=>{console.log(12),n.vertifyWrapClass="vertifyWrap shake",setTimeout(()=>{n.vertifyWrapClass="vertifyWrap"},800),l.emit("fail-slide")},L=e=>{const o=document.getElementById("canvasRef"),a=document.getElementById("blockRef");n.blockRef=a,console.log("canvasRef",M);const r=o.getContext("2d"),f=a.getContext("2d");v.value=k(u+10,c-(u+10)),R.value=k(10+d*2,p-(u+10)),S(r,v.value,R.value,"fill"),S(f,v.value,R.value,"clip"),r.drawImage(e,0,0,c,p),f.drawImage(e,0,0,c,p);const m=R.value-d*2-1,P=f.getImageData(v.value-3,m,u,u);a.width=u,f.putImageData(P,0,m)},W=()=>{const e=n.trailRef,o=e.reduce(I)/e.length,a=e.map(m=>m-o),r=Math.sqrt(a.map(T).reduce(I)/e.length),f=parseInt(n.blockRef.style.left);return{spliced:Math.abs(f-v.value)<10,verified:r!==0,left:f,destX:v.value}},y=()=>{const e=document.getElementById("canvasRef"),o=document.getElementById("blockRef"),a=e.getContext("2d"),r=o.getContext("2d");n.sliderLeft=0,n.sliderClass="sliderContainer",n.blockRef.width=c,n.blockRef.style.left=0+"px",a.clearRect(0,0,c,p),r.clearRect(0,0,c,p),console.log("state.imgRef",n.imgRef.src),n.imgRef.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"},z=function(e){console.log("e",e),C.value=e.clientX||e.touches[0].clientX,D.value=e.clientY||e.touches[0].clientY,n.isMouseDownRef=!0},B=e=>{if(!n.isMouseDownRef||(n.isMouseDownRef=!1,(e.clientX||e.changedTouches[0].clientX)===C.value))return!1;console.log("sliderClass",n.sliderClass.value),n.sliderClass="sliderContainer";const{spliced:a,verified:r}=W();a?r?(n.sliderClass="sliderContainer sliderContainer_success",typeof w=="function"&&w()):(console.log("sliderClass",n.sliderClass),n.sliderClass="sliderContainer sliderContainer_fail",n.textTip="请再试一次",y()):(n.sliderClass="sliderContainer sliderContainer_fail",typeof E=="function"&&E(),setTimeout(y.bind(this),1e3))},Y=e=>{if(!n.isMouseDownRef)return!1;e.preventDefault();const o=e.clientX||e.touches[0].clientX,a=e.clientY||e.touches[0].clientY,r=o-C.value,f=a-D.value;if(r<0||r+38>=c)return!1;n.sliderLeft=r;const m=(c-40-20)/(c-40)*r;console.log("blockRef",n.blockRef.style),n.blockRef.style.left=m+"px",n.sliderClass="sliderContainer sliderContainer_active",n.trailRef.push(f)};return s.onMounted(()=>{V()}),{...s.toRefs(n),handleDragStart:z,handleDragEnd:B,handleDragMove:Y,handleRefresh:X}}};const j=(t,l)=>{const n=t.__vccOpts||t;for(const[i,d]of l)n[i]=d;return n},b=t=>(s.pushScopeId("data-v-f87996d7"),t=t(),s.popScopeId(),t),q={ref:"canvasRef",width:"320",height:"160",id:"canvasRef"},F=b(()=>s.createElementVNode("div",{class:"sliderIcon"},"→",-1)),A=[F],$={class:"sliderText"},G=b(()=>s.createElementVNode("div",{class:"loadingIcon"},null,-1)),H=b(()=>s.createElementVNode("span",null,"加载中...",-1)),J=[G,H];function K(t,l){return s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(t.vertifyWrapClass),style:{width:"320px",margin:"0 auto"},onMousemove:l[5]||(l[5]=(...n)=>t.handleDragMove&&t.handleDragMove(...n)),onMouseup:l[6]||(l[6]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n)),onTouchmove:l[7]||(l[7]=(...n)=>t.handleDragMove&&t.handleDragMove(...n)),onTouchend:l[8]||(l[8]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n))},[s.createElementVNode("div",null,[s.createElementVNode("canvas",q,null,512),s.createElementVNode("canvas",{ref:"blockRef",class:"block",id:"blockRef",onMousedown:l[0]||(l[0]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onTouchstart:l[1]||(l[1]=(...n)=>t.handleDragStart&&t.handleDragStart(...n))},null,544)]),s.createElementVNode("div",{class:s.normalizeClass(t.sliderClass),style:s.normalizeStyle({pointerEvents:t.isLoading?"none":"auto",width:"320px"})},[s.createElementVNode("div",{class:"sliderMask",style:s.normalizeStyle({width:t.sliderLeft+"px"})},[s.createElementVNode("div",{class:"slider",style:s.normalizeStyle({left:t.sliderLeft+"px"}),onMousedown:l[2]||(l[2]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onTouchstart:l[3]||(l[3]=(...n)=>t.handleDragStart&&t.handleDragStart(...n))},A,36)],4),s.createElementVNode("div",$,s.toDisplayString(t.textTip),1)],6),s.createElementVNode("div",{className:"refreshIcon",onClick:l[4]||(l[4]=(...n)=>t.handleRefresh&&t.handleRefresh(...n)),style:s.normalizeStyle({backgroundImage:`url(${t.refreshIcon})`})},null,4),s.createElementVNode("div",{class:"loadingContainer",style:s.normalizeStyle({width:"320px",height:"160px",display:t.isLoading?"":"none"})},J,4)],34)}const h=j(O,[["render",K],["__scopeId","data-v-f87996d7"]]);h.install=t=>{t.component(h.name,h)};const Q=[h],U=t=>{Q.forEach(l=>{t.component(l.name,l)})},Z={install:U};exports.VertifySlide=h;exports.default=Z;
