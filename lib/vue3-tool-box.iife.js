var vue3ToolBox=function(R,s){"use strict";const T={name:"VertifySlide",props:{onDraw:t=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["verfity-slide","fail-slide"],setup(t,l){const n=s.reactive({sliderLeft:0,isLoading:!1,textTip:"",sliderClass:"sliderContainer",vertifyWrapClass:"vertifyWrap",blockRef:null,trailRef:[],isMouseDownRef:!1,imgRef:null,refreshIcon:"http://cdn.dooring.cn/dr/icon12.png"}),i=42,d=9,g=i+d*2+3,m=Math.PI,c=320,v=160;let P=s.ref(null);const u=s.ref(0),y=s.ref(0),D=s.ref(0),S=s.ref(0),k=(e,o,a,r)=>{console.log("ctx",e),e.beginPath(),e.moveTo(o,a),e.arc(o+i/2,a-d+2,d,.72*m,2.26*m),e.lineTo(o+i,a),e.arc(o+i+d-2,a+i/2,d,1.21*m,2.78*m),e.lineTo(o+i,a+i),e.lineTo(o,a+i),e.arc(o+d-2,a+i/2,d+.4,2.76*m,1.24*m,!0),e.lineTo(o,a),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over",r==="fill"?e.fill():e.clip()};function I(e,o){return Math.round(Math.random()*(o-e)+e)}function w(e,o){return e+o}function O(e){return e*e}const _=()=>{const e=j(()=>{F(e)});n.imgRef=e},j=e=>{const o=new Image;return o.onload=e,o.crossOrigin="Anonymous",console.log("img",o),o.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",o},q=()=>{C()},E=()=>{console.log(222),C(),l.emit("verfity-slide")},M=()=>{console.log(12),n.vertifyWrapClass="vertifyWrap shake",setTimeout(()=>{n.vertifyWrapClass="vertifyWrap"},800),l.emit("fail-slide")},F=e=>{const o=document.getElementById("canvasRef"),a=document.getElementById("blockRef");n.blockRef=a,console.log("canvasRef",P);const r=o.getContext("2d"),f=a.getContext("2d");u.value=I(g+10,c-(g+10)),y.value=I(10+d*2,v-(g+10)),k(r,u.value,y.value,"fill"),k(f,u.value,y.value,"clip"),r.drawImage(e,0,0,c,v),f.drawImage(e,0,0,c,v);const p=y.value-d*2-1,J=f.getImageData(u.value-3,p,g,g);a.width=g,f.putImageData(J,0,p)},A=()=>{const e=n.trailRef,o=e.reduce(w)/e.length,a=e.map(p=>p-o),r=Math.sqrt(a.map(O).reduce(w)/e.length),f=parseInt(n.blockRef.style.left);return{spliced:Math.abs(f-u.value)<10,verified:r!==0,left:f,destX:u.value}},C=()=>{const e=document.getElementById("canvasRef"),o=document.getElementById("blockRef"),a=e.getContext("2d"),r=o.getContext("2d");n.sliderLeft=0,n.sliderClass="sliderContainer",n.blockRef.width=c,n.blockRef.style.left=0+"px",a.clearRect(0,0,c,v),r.clearRect(0,0,c,v),console.log("state.imgRef",n.imgRef.src),n.imgRef.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"},$=function(e){console.log("e",e),D.value=e.clientX||e.touches[0].clientX,S.value=e.clientY||e.touches[0].clientY,n.isMouseDownRef=!0},G=e=>{if(!n.isMouseDownRef||(n.isMouseDownRef=!1,(e.clientX||e.changedTouches[0].clientX)===D.value))return!1;console.log("sliderClass",n.sliderClass.value),n.sliderClass="sliderContainer";const{spliced:a,verified:r}=A();a?r?(n.sliderClass="sliderContainer sliderContainer_success",typeof E=="function"&&E()):(console.log("sliderClass",n.sliderClass),n.sliderClass="sliderContainer sliderContainer_fail",n.textTip="请再试一次",C()):(n.sliderClass="sliderContainer sliderContainer_fail",typeof M=="function"&&M(),setTimeout(C.bind(this),1e3))},H=e=>{if(!n.isMouseDownRef)return!1;e.preventDefault();const o=e.clientX||e.touches[0].clientX,a=e.clientY||e.touches[0].clientY,r=o-D.value,f=a-S.value;if(r<0||r+38>=c)return!1;n.sliderLeft=r;const p=(c-40-20)/(c-40)*r;console.log("blockRef",n.blockRef.style),n.blockRef.style.left=p+"px",n.sliderClass="sliderContainer sliderContainer_active",n.trailRef.push(f)};return s.onMounted(()=>{_()}),{...s.toRefs(n),handleDragStart:$,handleDragEnd:G,handleDragMove:H,handleRefresh:q}}},K="",V=(t,l)=>{const n=t.__vccOpts||t;for(const[i,d]of l)n[i]=d;return n},b=t=>(s.pushScopeId("data-v-f87996d7"),t=t(),s.popScopeId(),t),N={ref:"canvasRef",width:"320",height:"160",id:"canvasRef"},X=[b(()=>s.createElementVNode("div",{class:"sliderIcon"},"→",-1))],L={class:"sliderText"},B=[b(()=>s.createElementVNode("div",{class:"loadingIcon"},null,-1)),b(()=>s.createElementVNode("span",null,"加载中...",-1))];function W(t,l){return s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(t.vertifyWrapClass),style:{width:"320px",margin:"0 auto"},onMousemove:l[5]||(l[5]=(...n)=>t.handleDragMove&&t.handleDragMove(...n)),onMouseup:l[6]||(l[6]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n)),onTouchmove:l[7]||(l[7]=(...n)=>t.handleDragMove&&t.handleDragMove(...n)),onTouchend:l[8]||(l[8]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n))},[s.createElementVNode("div",null,[s.createElementVNode("canvas",N,null,512),s.createElementVNode("canvas",{ref:"blockRef",class:"block",id:"blockRef",onMousedown:l[0]||(l[0]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onTouchstart:l[1]||(l[1]=(...n)=>t.handleDragStart&&t.handleDragStart(...n))},null,544)]),s.createElementVNode("div",{class:s.normalizeClass(t.sliderClass),style:s.normalizeStyle({pointerEvents:t.isLoading?"none":"auto",width:"320px"})},[s.createElementVNode("div",{class:"sliderMask",style:s.normalizeStyle({width:t.sliderLeft+"px"})},[s.createElementVNode("div",{class:"slider",style:s.normalizeStyle({left:t.sliderLeft+"px"}),onMousedown:l[2]||(l[2]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onTouchstart:l[3]||(l[3]=(...n)=>t.handleDragStart&&t.handleDragStart(...n))},X,36)],4),s.createElementVNode("div",L,s.toDisplayString(t.textTip),1)],6),s.createElementVNode("div",{className:"refreshIcon",onClick:l[4]||(l[4]=(...n)=>t.handleRefresh&&t.handleRefresh(...n)),style:s.normalizeStyle({backgroundImage:`url(${t.refreshIcon})`})},null,4),s.createElementVNode("div",{class:"loadingContainer",style:s.normalizeStyle({width:"320px",height:"160px",display:t.isLoading?"":"none"})},B,4)],34)}const h=V(T,[["render",W],["__scopeId","data-v-f87996d7"]]);h.install=t=>{t.component(h.name,h)};const z=[h],Y={install:t=>{z.forEach(l=>{t.component(l.name,l)})}};return R.VertifySlide=h,R.default=Y,Object.defineProperties(R,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),R}({},Vue);
