(function(f,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],l):(f=typeof globalThis<"u"?globalThis:f||self,l(f.Vue3ToolBox={},f.Vue))})(this,function(f,l){"use strict";const T={props:{onDraw:d=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["verfity-slide","fail-slide"],setup(d,u){const t=l.reactive({sliderLeft:0,isLoading:!1,textTip:"",sliderClass:"sliderContainer",vertifyWrapClass:"vertifyWrap",blockRef:null,trailRef:[],isMouseDownRef:!1,imgRef:null,refreshIcon:"http://cdn.dooring.cn/dr/icon12.png"}),i=42,a=9,g=i+a*2+3,p=Math.PI,r=320,R=160;let W=l.ref(null);const m=l.ref(0),C=l.ref(0),y=l.ref(0),b=l.ref(0),k=(e,s,n,o)=>{console.log("ctx",e),e.beginPath(),e.moveTo(s,n),e.arc(s+i/2,n-a+2,a,.72*p,2.26*p),e.lineTo(s+i,n),e.arc(s+i+a-2,n+i/2,a,1.21*p,2.78*p),e.lineTo(s+i,n+i),e.lineTo(s,n+i),e.arc(s+a-2,n+i/2,a+.4,2.76*p,1.24*p,!0),e.lineTo(s,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over",o==="fill"?e.fill():e.clip()};function I(e,s){return Math.round(Math.random()*(s-e)+e)}function w(e,s){return e+s}function Y(e){return e*e}const B=()=>{const e=E(()=>{P(e)});t.imgRef=e},E=e=>{const s=new Image;return s.onload=e,s.crossOrigin="Anonymous",console.log("img",s),s.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",s},L=()=>{_()},D=()=>{console.log(222),_(),u.emit("verfity-slide")},M=()=>{console.log(12),t.vertifyWrapClass="vertifyWrap shake",setTimeout(()=>{t.vertifyWrapClass="vertifyWrap"},800),u.emit("fail-slide")},P=e=>{const s=document.getElementById("canvasRef"),n=document.getElementById("blockRef");t.blockRef=n,console.log("canvasRef",W);const o=s.getContext("2d"),c=n.getContext("2d");m.value=I(g+10,r-(g+10)),C.value=I(10+a*2,R-(g+10)),k(o,m.value,C.value,"fill"),k(c,m.value,C.value,"clip"),o.drawImage(e,0,0,r,R),c.drawImage(e,0,0,r,R);const v=C.value-a*2-1,V=c.getImageData(m.value-3,v,g,g);n.width=g,c.putImageData(V,0,v)},j=()=>{const e=t.trailRef,s=e.reduce(w)/e.length,n=e.map(v=>v-s),o=Math.sqrt(n.map(Y).reduce(w)/e.length),c=parseInt(t.blockRef.style.left);return{spliced:Math.abs(c-m.value)<10,verified:o!==0,left:c,destX:m.value}},_=()=>{const e=document.getElementById("canvasRef"),s=document.getElementById("blockRef"),n=e.getContext("2d"),o=s.getContext("2d");t.sliderLeft=0,t.sliderClass="sliderContainer",t.blockRef.width=r,t.blockRef.style.left=0+"px",n.clearRect(0,0,r,R),o.clearRect(0,0,r,R),console.log("state.imgRef",t.imgRef.src),t.imgRef.src="https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"},O=function(e){console.log("e",e),y.value=e.clientX||e.touches[0].clientX,b.value=e.clientY||e.touches[0].clientY,t.isMouseDownRef=!0},q=e=>{if(!t.isMouseDownRef||(t.isMouseDownRef=!1,(e.clientX||e.changedTouches[0].clientX)===y.value))return!1;console.log("sliderClass",t.sliderClass.value),t.sliderClass="sliderContainer";const{spliced:n,verified:o}=j();n?o?(t.sliderClass="sliderContainer sliderContainer_success",typeof D=="function"&&D()):(console.log("sliderClass",t.sliderClass),t.sliderClass="sliderContainer sliderContainer_fail",t.textTip="请再试一次",_()):(t.sliderClass="sliderContainer sliderContainer_fail",typeof M=="function"&&M(),setTimeout(_.bind(this),1e3))},F=e=>{if(!t.isMouseDownRef)return!1;e.preventDefault();const s=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,o=s-y.value,c=n-b.value;if(o<0||o+38>=r)return!1;t.sliderLeft=o;const v=(r-40-20)/(r-40)*o;console.log("blockRef",t.blockRef.style),t.blockRef.style.left=v+"px",t.sliderClass="sliderContainer sliderContainer_active",t.trailRef.push(c)};return l.onMounted(()=>{B()}),{...l.toRefs(t),handleDragStart:O,handleDragEnd:q,handleDragMove:F,handleRefresh:L}}},A="",h=((d,u)=>{const t=d.__vccOpts||d;for(const[i,a]of u)t[i]=a;return t})(T,[["__scopeId","data-v-5928d181"]]);h.install=d=>{d.component(h.__name,h)};const X=[h],S={install:d=>{X.forEach(u=>{d.component(u.__name,u)})}};f.default=S,f.vertifySlide=h,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
